name: Github Deploy  # 定义工作流的名称

on: [push, pull_request] # 定义触发条件。这个工作流将在 push 或 pull_request 事件发生时触发。

github-release:
  name: >-
    Upload to GitHub Release
  needs:
    - deploy-binaries
    - publish-to-pypi
  runs-on: ubuntu-latest

  permissions:
    contents: write  # IMPORTANT: mandatory for making GitHub Releases
    id-token: write  # IMPORTANT: mandatory for sigstore

  steps:
    - name: Download all the dists
      uses: actions/download-artifact@v3
      with:
        name: binary-distributions
        path: dist/
    - name: Create GitHub Release
      env:
        GITHUB_TOKEN: ${{ github.token }}
      run: >-
        gh release create
        '${{ github.ref_name }}'
        --repo '${{ github.repository }}'
        --notes ""
        --prerelease
        --generate-notes
        --title 'Furious ${{ github.ref_name }}'
    - name: Upload artifact to GitHub Release
      env:
        GITHUB_TOKEN: ${{ github.token }}
      # Upload to GitHub Release using the `gh` CLI.
      run: >-
        gh release upload
        '${{ github.ref_name }}' dist/**
    --repo '${{ github.repository }}'